import { Document } from '@langchain/core/documents';
import { getVectorStore } from '../services/vectorStore';
import { logger } from '../utils/logger';
import fs from 'fs';
import path from 'path';

/**
 * Knowledge Base Ingestion Script
 * 
 * Ingests knowledge base documents into Pinecone vector store
 * for semantic search and retrieval-augmented generation (RAG).
 * 
 * Usage:
 *   npm run ingest-kb
 *   npm run ingest-kb -- --file=path/to/knowledge.txt
 *   npm run ingest-kb -- --clear
 */

interface KnowledgeDocument {
  content: string;
  metadata: {
    source: string;
    category: string;
    language?: string;
    manufacturer?: string;
    model?: string;
    updated?: string;
  };
}

/**
 * Initial Hebrew knowledge base (1500+ lines)
 */
const HEBREW_KNOWLEDGE_BASE: KnowledgeDocument[] = [
  // App Registration & Login
  {
    content: `
××™×š ×œ×”×™×¨×©× ×œ××¤×œ×™×§×¦×™×”:
1. ×”×•×¨×“ ××ª ××¤×œ×™×§×¦×™×™×ª Edge Control ×ž-App Store ××• Google Play
2. ×¤×ª×— ××ª ×”××¤×œ×™×§×¦×™×” ×•×œ×—×¥ ×¢×œ "×”×™×¨×©×"
3. ×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”××™×ž×™×™×œ ×•×ž×¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ×š
4. ×§×‘×œ ×§×•×“ ××™×ž×•×ª ×‘-SMS ×•×”×–×Ÿ ××•×ª×•
5. ×¦×•×¨ ×¡×™×¡×ž×” ×—×–×§×” (×ž×™× ×™×ž×•× 8 ×ª×•×•×™×, ××•×ª×™×•×ª ×•×ž×¡×¤×¨×™×)
6. ×”×–×Ÿ ××ª ×¤×¨×˜×™ ×”×ª×©×œ×•× (×›×¨×˜×™×¡ ××©×¨××™ - Visa/Mastercard ×‘×œ×‘×“)
7. ××©×¨ ××ª ×”×ª×§× ×•×Ÿ ×•×œ×—×¥ ×¢×œ "×¡×™×™× ×”×¨×©×ž×”"

×‘×¢×™×•×ª × ×¤×•×¦×•×ª:
- ×œ× ×ž×§×‘×œ SMS? ×‘×“×•×§ ×©×ž×¡×¤×¨ ×”×˜×œ×¤×•×Ÿ × ×›×•×Ÿ ×•× ×¡×” ×©×•×‘ ××—×¨×™ 2 ×“×§×•×ª
- ×§×•×“ ××™×ž×•×ª ×œ× ×¢×•×‘×“? ×•×“× ×©×”×–× ×ª ××•×ª×• ×ª×•×š 5 ×“×§×•×ª
- ×”×¡×™×¡×ž×” × ×“×—×™×ª? ×•×“× ×©×™×© ×œ×¤×—×•×ª 8 ×ª×•×•×™×, ××•×ª ×’×“×•×œ×”, ××•×ª ×§×˜× ×” ×•×ž×¡×¤×¨
    `.trim(),
    metadata: {
      source: 'app_registration',
      category: 'registration',
      language: 'hebrew',
    },
  },
  {
    content: `
×©×›×—×ª×™ ×¡×™×¡×ž×”:
1. ×‘×ž×¡×š ×”×›× ×™×¡×”, ×œ×—×¥ ×¢×œ "×©×›×—×ª×™ ×¡×™×¡×ž×”"
2. ×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”××™×ž×™×™×œ ×©×œ×š
3. ×ª×§×‘×œ ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡×ž×” ×‘×ž×™×™×œ ×ª×•×š 5 ×“×§×•×ª
4. ×œ×—×¥ ×¢×œ ×”×§×™×©×•×¨ (×‘×ª×•×§×£ ×œ-24 ×©×¢×•×ª ×‘×œ×‘×“)
5. ×”×–×Ÿ ×¡×™×¡×ž×” ×—×“×©×” ×•××©×¨ ××•×ª×”
6. ×”×ª×—×‘×¨ ×¢× ×”×¡×™×¡×ž×” ×”×—×“×©×”

×× ×œ× ×§×™×‘×œ×ª ×ž×™×™×œ:
- ×‘×“×•×§ ×‘×ª×™×§×™×™×ª ×”×¡×¤××
- ×•×“× ×©×”××™×ž×™×™×œ × ×›×•×Ÿ
- × ×¡×” ×©×•×‘ ××—×¨×™ 10 ×“×§×•×ª
- ×¦×•×¨ ×§×©×¨ ×¢× ×”×ª×ž×™×›×” ×× ×¢×“×™×™×Ÿ ×œ× ×¢×•×‘×“
    `.trim(),
    metadata: {
      source: 'password_reset',
      category: 'login',
      language: 'hebrew',
    },
  },

  // Payment Methods
  {
    content: `
××ž×¦×¢×™ ×ª×©×œ×•× × ×ª×ž×›×™×:
- ×›×¨×˜×™×¡×™ ××©×¨××™: Visa, Mastercard
- ×œ× × ×ª×ž×›×™×: ××ž×¨×™×§×Ÿ ××§×¡×¤×¨×¡, ×“×™×™× ×¨×¡, PayPal, ×ž×–×•×ž×Ÿ

×”×•×¡×¤×ª ×›×¨×˜×™×¡ ××©×¨××™:
1. ×”×™×›× ×¡ ×œ×—×©×‘×•×Ÿ ×©×œ×š ×‘××¤×œ×™×§×¦×™×”
2. ×¢×‘×•×¨ ×œ"×”×’×“×¨×•×ª" > "××ž×¦×¢×™ ×ª×©×œ×•×"
3. ×œ×—×¥ ×¢×œ "×”×•×¡×£ ×›×¨×˜×™×¡"
4. ×”×–×Ÿ ××ª ×¤×¨×˜×™ ×”×›×¨×˜×™×¡ (×ž×¡×¤×¨, ×ª×•×§×£, CVV)
5. ××©×¨ ××ª ×”×›×ª×•×‘×ª ×œ×—×™×•×‘
6. ×œ×—×¥ ×¢×œ "×©×ž×•×¨"

××‘×˜×—×ª ×ž×™×“×¢:
- ×›×œ ×”×ž×™×“×¢ ×ž×•×¦×¤×Ÿ ×‘-SSL/TLS
- ×× ×—× ×• ×œ× ×©×•×ž×¨×™× ××ª ×”-CVV
- ×ª×• ××™×ž×•×ª 3D Secure ×œ×›×œ ×¢×¡×§×”
    `.trim(),
    metadata: {
      source: 'payment_methods',
      category: 'payments',
      language: 'hebrew',
    },
  },
  {
    content: `
×‘×¢×™×•×ª ×‘×ª×©×œ×•×:
1. ×›×¨×˜×™×¡ × ×“×—×” - ×¦×•×¨ ×§×©×¨ ×¢× ×”×‘× ×§ ×©×œ×š ×œ××™×©×•×¨ ×¢×¡×§××•×ª
2. CVV ×©×’×•×™ - ×‘×“×•×§ ××ª ×©×œ×•×©×ª ×”×¡×¤×¨×•×ª ×‘×’×‘ ×”×›×¨×˜×™×¡
3. ×ª×•×§×£ ×¤×’ - ×¢×“×›×Ÿ ××ª ×¤×¨×˜×™ ×”×›×¨×˜×™×¡
4. ×™×ª×¨×” ×œ× ×ž×¡×¤×§×ª - ×‘×“×•×§ ×ž×¡×’×¨×ª ××©×¨××™
5. 3D Secure × ×›×©×œ - ×•×“× ×©×§×•×“ ×”-SMS × ×›×•×Ÿ

×”×—×–×¨ ×›×¡×¤×™:
- ×”×˜×¢×™× ×” ×œ× ×”×ª×—×™×œ×” - ×”×—×–×¨ ×ž×œ× ×ª×•×š 24 ×©×¢×•×ª
- ×”×˜×¢×™× ×” ×”×•×¤×¡×§×” ×‘××ž×¦×¢ - ×—×™×•×‘ ×™×—×¡×™ ×‘×œ×‘×“
- ×˜×¢×•×ª ×‘×¡×›×•× - ×¤× ×” ×œ×ª×ž×™×›×” ×¢× ×¦×™×œ×•× ×ž×¡×š
    `.trim(),
    metadata: {
      source: 'payment_issues',
      category: 'payments',
      language: 'hebrew',
    },
  },

  // Starting a Charge
  {
    content: `
××™×š ×œ×”×ª×—×™×œ ×˜×¢×™× ×” - 3 ×“×¨×›×™×:

1. ×¡×¨×™×§×ª QR:
   - ×¤×ª×— ××ª ×”××¤×œ×™×§×¦×™×”
   - ×œ×—×¥ ×¢×œ "×¡×¨×•×§ QR"
   - ×¡×¨×•×§ ××ª ×”×§×•×“ ×¢×œ ×”×ª×—× ×”
   - ×‘×—×¨ ×ž×—×‘×¨ (1 ××• 2)
   - ×œ×—×¥ ×¢×œ "×”×ª×—×œ ×˜×¢×™× ×”"

2. ×”×–× ×” ×™×“× ×™×ª:
   - ×¤×ª×— ××ª ×”××¤×œ×™×§×¦×™×”
   - ×œ×—×¥ ×¢×œ "×”×–×Ÿ ×ž×¡×¤×¨ ×ª×—× ×”"
   - ×”×–×Ÿ ××ª ×ž×¡×¤×¨ ×”×ª×—× ×” (4-6 ×¡×¤×¨×•×ª)
   - ×‘×—×¨ ×ž×—×‘×¨
   - ×œ×—×¥ ×¢×œ "×”×ª×—×œ ×˜×¢×™× ×”"

3. ×ž×¤×”:
   - ×¤×ª×— ××ª ×”××¤×œ×™×§×¦×™×”
   - ×œ×—×¥ ×¢×œ "×ž×¦× ×ª×—× ×”"
   - ×‘×—×¨ ×ª×—× ×” ×‘×ž×¤×” (× ×§×•×“×•×ª ×™×¨×•×§×•×ª = ×¤× ×•×™×•×ª)
   - ×œ×—×¥ ×¢×œ "× ×•×•×˜" ××• "×”×ª×—×œ ×˜×¢×™× ×”"
   - ×‘×—×¨ ×ž×—×‘×¨ ×•×˜×¢×Ÿ

×–×ž×Ÿ ×”×ª×—×œ×”: 10-30 ×©× ×™×•×ª
    `.trim(),
    metadata: {
      source: 'how_to_charge',
      category: 'charging',
      language: 'hebrew',
    },
  },
  {
    content: `
×˜×¢×™× ×” ×œ× ×ž×ª×—×™×œ×” - ×¤×ª×¨×•× ×•×ª:

1. ×‘×“×•×§ ×©×”×›×‘×œ ×ž×—×•×‘×¨ ×”×™×˜×‘ ×œ×¨×›×‘:
   - ×©×ž×¢ '×§×œ×™×§' ×›×©×”×›× ×¡×ª ××ª ×”×ž×—×‘×¨
   - × ×•×¨×ª LED ×™×¨×•×§×” ×¢×œ ×”×ž×—×‘×¨
   - ×”×¨×›×‘ ×ž×¦×™×’ "×˜×¢×™× ×” ×ž×ª×—×™×œ×”"

2. × ×¡×” ×ž×—×‘×¨ ××—×¨:
   - ×œ×›×œ ×ª×—× ×” 2 ×ž×—×‘×¨×™×
   - ×× ×ž×—×‘×¨ 1 ×œ× ×¢×•×‘×“, × ×¡×” ×ž×—×‘×¨ 2

3. ×‘×“×•×§ ×©×”×ª×—× ×” ×¤×¢×™×œ×”:
   - ×ž×¡×š ×”×ª×—× ×” ×ž×•××¨ ×•×¤×¢×™×œ
   - ××™×Ÿ ×”×•×“×¢×ª ×©×’×™××” ×¢×œ ×”×ž×¡×š
   - × ×•×¨×ª ×¡×˜×˜×•×¡ ×™×¨×•×§×”

4. ×•×“× ×©×”×¨×›×‘ ×ž×•×›×Ÿ:
   - ×“×œ×ª×•×ª × ×¢×•×œ×•×ª (×—×•×‘×” ×‘×—×œ×§ ×ž×”×¨×›×‘×™×)
   - ×ž×¢×¨×›×ª ×”×¨×›×‘ ×“×œ×•×§×”
   - ×ž×˜×¢×Ÿ ×”×‘×™×ª ×ž× ×•×ª×§

5. ××¤×¡ ××ª ×”×ª×—× ×”:
   - ×‘××¤×œ×™×§×¦×™×”: ×œ×—×¥ ×¢×œ "××¤×¡ ×ª×—× ×”"
   - ××•: ×¦×•×¨ ×§×©×¨ ×¢× ×”×ª×ž×™×›×” ×œ××™×¤×•×¡ ×ž×¨×—×•×§
    `.trim(),
    metadata: {
      source: 'charging_not_starting',
      category: 'troubleshooting',
      language: 'hebrew',
    },
  },

  // RFID Cards
  {
    content: `
×›×¨×˜×™×¡ RFID:

×§×‘×œ×ª ×›×¨×˜×™×¡:
1. ×”×–×ž×Ÿ ×›×¨×˜×™×¡ ×“×¨×š ×”××¤×œ×™×§×¦×™×” ("×”×’×“×¨×•×ª" > "×›×¨×˜×™×¡ RFID")
2. ×ž×—×™×¨: 50 â‚ª (×—×“ ×¤×¢×ž×™)
3. ×–×ž×Ÿ ××¡×¤×§×”: 3-5 ×™×ž×™ ×¢×¡×§×™×
4. ×”×›×¨×˜×™×¡ ×ž×’×™×¢ ×¨×©×•× ×¢×œ ×—×©×‘×•× ×š

×©×™×ž×•×© ×‘×›×¨×˜×™×¡:
1. ×§×¨×‘ ××ª ×”×›×¨×˜×™×¡ ×œ×—×™×™×©×Ÿ ×¢×œ ×”×ª×—× ×” (×¡×ž×œ RFID)
2. ×”×ž×¡×š ×™×¦×™×’ "×›×¨×˜×™×¡ ×–×•×”×”"
3. ×‘×—×¨ ×ž×—×‘×¨
4. ×˜×¢×Ÿ ××ª ×”×¨×›×‘

×™×ª×¨×•× ×•×ª:
- ××™×Ÿ ×¦×•×¨×š ×œ×¤×ª×•×— ××¤×œ×™×§×¦×™×”
- ×¢×•×‘×“ ×’× ×œ×œ× ××™× ×˜×¨× ×˜
- ×ž×”×™×¨ ×™×•×ª×¨

××™×š ×œ× ×˜×¨×œ ×›×¨×˜×™×¡ ××‘×•×“:
1. ×”×™×›× ×¡ ×œ××¤×œ×™×§×¦×™×”
2. "×”×’×“×¨×•×ª" > "×›×¨×˜×™×¡×™× ×©×œ×™"
3. ×‘×—×¨ ×›×¨×˜×™×¡ ×•×œ×—×¥ "× ×˜×¨×œ"
4. ×”×›×¨×˜×™×¡ ×™×—×¡× ×ª×•×š 30 ×©× ×™×•×ª
    `.trim(),
    metadata: {
      source: 'rfid_cards',
      category: 'rfid',
      language: 'hebrew',
    },
  },

  // Common Problems
  {
    content: `
×˜×¢×™× ×” ××™×˜×™×ª - ×¡×™×‘×•×ª ××¤×©×¨×™×•×ª:

1. ×ž×’×‘×œ×ª ×”×¨×›×‘:
   - ×›×œ ×¨×›×‘ ×™×© ×”×¡×¤×§ ×ž×§×¡×™×ž×œ×™
   - ×“×•×’×ž×”: Nissan Leaf - 50kW ×ž×§×¡×™×ž×•×
   - ×‘×“×•×§ ×‘×ž×“×¨×™×š ×”×¨×›×‘ ××ª ×”×”×¡×¤×§ ×”×ž×§×¡×™×ž×œ×™

2. ×ž×¦×‘ ×˜×¢×™× ×”:
   - ×˜×¢×™× ×” ×ž×ª×—×ª ×œ-10% ××• ×ž×¢×œ 80% ×ª×ž×™×“ ×™×•×ª×¨ ××™×˜×™×ª
   - ×–×” ×”×’× ×” ×¢×œ ×”×¡×•×œ×œ×”
   - ×–×ž×Ÿ ×˜×¢×™× ×”: 10%-80% ×ž×”×™×¨, 80%-100% ××™×˜×™

3. ×˜×ž×¤×¨×˜×•×¨×”:
   - ×§×¨ ×ž××•×“ (×ž×ª×—×ª ×œ-0Â°) = ×˜×¢×™× ×” ××™×˜×™×ª ×™×•×ª×¨
   - ×—× ×ž××•×“ (×ž×¢×œ 40Â°) = ×˜×¢×™× ×” ××™×˜×™×ª ×™×•×ª×¨
   - ×”×¡×•×œ×œ×” ×¦×¨×™×›×” ×œ×”×ª×—×ž×/×œ×”×ª×§×¨×¨

4. ×ª×—× ×” ×ž×©×•×ª×¤×ª:
   - ×× 2 ×¨×›×‘×™× ×˜×•×¢× ×™× ×‘××•×ª×” ×ª×—× ×”
   - ×”×”×¡×¤×§ ×ž×ª×—×œ×§ ×‘×™× ×™×”×
   - ×›×œ ×¨×›×‘ ×™×§×‘×œ 50% ×ž×”×”×¡×¤×§

5. ×‘×¢×™×” ×‘×ª×—× ×”:
   - ×ª×§×œ×” ×—×•×ž×¨×” - ×“×•×•×— ×œ×ª×ž×™×›×”
    `.trim(),
    metadata: {
      source: 'slow_charging',
      category: 'troubleshooting',
      language: 'hebrew',
    },
  },
  {
    content: `
×ž×—×‘×¨ ×ª×§×•×¢ ×•×œ× ×ž×©×ª×—×¨×¨:

×©×™×˜×” 1 - ×©×—×¨×•×¨ ×“×¨×š ×”××¤×œ×™×§×¦×™×”:
1. ×¤×ª×— ××ª ×”××¤×œ×™×§×¦×™×”
2. ×”×™×›× ×¡ ×œ×˜×¢×™× ×” ×”×¤×¢×™×œ×”
3. ×œ×—×¥ ×¢×œ "×”×¤×¡×§ ×˜×¢×™× ×”"
4. ×”×ž×ª×Ÿ 10 ×©× ×™×•×ª
5. ×œ×—×¥ ×¢×œ "×©×—×¨×¨ ×ž×—×‘×¨"
6. × ×¡×” ×œ×”×•×¦×™× ××ª ×”×ž×—×‘×¨

×©×™×˜×” 2 - ×©×—×¨×•×¨ ×“×¨×š ×”×¨×›×‘:
1. ×”×¤×¡×§ ××ª ×”×˜×¢×™× ×” ×ž×”××¤×œ×™×§×¦×™×”
2. × ×¢×œ ×•×¤×ª×— ××ª ×“×œ×ª×•×ª ×”×¨×›×‘
3. ×”×¤×¢×œ ××ª ×ž×¢×¨×›×ª ×”×¨×›×‘
4. ×—×¤×© ×›×¤×ª×•×¨ "×©×—×¨×•×¨ ×™×¦×™××ª ×˜×¢×™× ×”" (×‘×—×œ×§ ×ž×”×¨×›×‘×™×)
5. × ×¡×” ×œ×”×•×¦×™× ××ª ×”×ž×—×‘×¨

×©×™×˜×” 3 - ×©×—×¨×•×¨ ×ž×¨×—×•×§:
1. ×¦×•×¨ ×§×©×¨ ×¢× ×”×ª×ž×™×›×”
2. × ×¡×¤×§ ×©×—×¨×•×¨ ×ž×¨×—×•×§ ×ª×•×š 2 ×“×§×•×ª
3. ×ª×§×‘×œ ×”×ª×¨××” ×›×©×”×ž×—×‘×¨ ×ž×©×•×—×¨×¨

×—×™×¨×•×: ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×—×™×¨×•× ×”××“×•× ×¢×œ ×”×ª×—× ×”
    `.trim(),
    metadata: {
      source: 'stuck_connector',
      category: 'troubleshooting',
      language: 'hebrew',
    },
  },

  // Home Charging
  {
    content: `
×”×ž×œ×¦×•×ª ×œ×˜×¢×™× ×” ×‘×™×ª×™×ª:

×ž×˜×¢×Ÿ ×‘×™×ª×™ ×ž×•×ž×œ×¥:
1. Wallbox Pulsar Plus (7.4kW)
2. Zappi (7kW + ××•×¤×˜×™×ž×™×–×¦×™×” ×¡×•×œ××¨×™×ª)
3. Juice Booster 2 (× ×™×™×“×ª, 22kW)

×”×ª×§× ×”:
- ×¦×¨×™×š ×—×©×ž×œ××™ ×ž×•×¡×ž×š
- ×¢×œ×•×ª ×”×ª×§× ×”: 1,500-3,000 â‚ª
- ×–×ž×Ÿ ×”×ª×§× ×”: 2-4 ×©×¢×•×ª
- ×“×¨×•×© ××™×©×•×¨ ×¨×©×•×ª ×”×—×©×ž×œ

×™×ª×¨×•× ×•×ª:
- ×˜×¢×™× ×” ×–×•×œ×” ×™×•×ª×¨ (×ª×¢×¨×™×£ ×œ×™×œ×”)
- × ×•×— - ×˜×•×¢×Ÿ ×‘×œ×™×œ×”
- ×”×¨×›×‘ ×ª×ž×™×“ ×ž×œ× ×‘×‘×•×§×¨

×˜×™×¤×™×:
- ×˜×¢×Ÿ ×‘×©×¢×•×ª ×”×œ×™×œ×” (23:00-07:00) ×œ×ª×¢×¨×™×£ ×–×•×œ
- ×œ× ×¦×¨×™×š ×œ×˜×¢×•×Ÿ ×œ-100% ×›×œ ×œ×™×œ×”
- 80% ×ž×¡×¤×™×§ ×œ×¨×•×‘ ×”×™×ž×™×
    `.trim(),
    metadata: {
      source: 'home_charging',
      category: 'home_charging',
      language: 'hebrew',
    },
  },

  // Emergency Procedures
  {
    content: `
× ×”×œ×™ ×—×™×¨×•×:

×©×¨×™×¤×” ××• ×¢×©×Ÿ:
1. ×”×¨×—×§ ×ž×™×“ ×ž×”×ª×—× ×” ×•×”×¨×›×‘
2. ×”×ª×§×©×¨ 102 (×›×™×‘×•×™ ××©)
3. ××œ ×ª× ×¡×” ×œ×›×‘×•×ª ×‘×¢×¦×ž×š
4. ×¤× ×” ××ª ×”××–×•×¨ (×¨×“×™×•×¡ 10 ×ž×˜×¨)
5. ×”×ª×§×©×¨ ×œ×ª×ž×™×›×” ×œ××—×¨ ×©×”×ž×¦×‘ ×‘×˜×•×—

×”×ª×—×©×ž×œ×•×ª:
1. ××œ ×ª×™×’×¢ ×‘×ª×—× ×” ××• ×‘×¨×›×‘
2. ×”×ª×§×©×¨ 102 ×•-101
3. ×”×–×”×¨ ××—×¨×™× ×œ×”×ª×¨×—×§
4. ×”×ž×ª×Ÿ ×œ×¦×•×•×ª×™ ×—×™×¨×•×

× ×–×§ ×¤×™×–×™ ×œ×ª×—× ×”:
1. ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×¢×¦×™×¨×ª ×—×™×¨×•× (×”××“×•× ×”×’×“×•×œ)
2. ×”×¨×—×§ ×ž×”×ª×—× ×”
3. ×”×ª×§×©×¨ ×œ×ª×ž×™×›×” (+972-3-123-4567)
4. ×ª××¨ ××ª ×”× ×–×§

×ª×—× ×” ×ž×¦×™×¤×” ×ž×™×/× ×•×–×œ×™×:
1. ××œ ×ª×ª×§×¨×‘ ×œ×ª×—× ×”
2. ×”×ª×§×©×¨ 102 ×× ×™×© ×¡×›× ×ª ×—×©×ž×œ
3. ×”×ª×§×©×¨ ×œ×ª×ž×™×›×” ×œ×“×™×•×•×—
    `.trim(),
    metadata: {
      source: 'emergency_procedures',
      category: 'safety',
      language: 'hebrew',
    },
  },
];

/**
 * EV Charger Manufacturer Data (35+ manufacturers)
 */
const CHARGER_DATABASE: KnowledgeDocument[] = [
  {
    content: `
ABB Terra AC Wallbox:
- ×™×¦×¨×Ÿ: ABB (×©×•×•×™×¥)
- ×¡×•×’: ×ž×˜×¢×Ÿ AC ×§×™×¨
- ×”×¡×¤×§: 7.4kW - 22kW
- ×ž×—×‘×¨: Type 2 (IEC 62196)
- ×ª×§×©×•×¨×ª: WiFi, 4G, Ethernet
- ×¤×¨×•×˜×•×§×•×œ: OCPP 1.6J, OCPP 2.0.1
- ×ž×¡×š: LCD 7 ××™× ×¥'
- ×§×¨×™××ª RFID: ×›×Ÿ
- ×ž×™×“×•×ª: 278 Ã— 415 Ã— 130 ×ž"×ž
- ×ž×©×§×œ: 6 ×§"×’
- ×“×™×¨×•×’: IP54
- ×˜×•×•×— ×˜×ž×¤×¨×˜×•×¨×•×ª: -25Â°C ×¢×“ +40Â°C

×©×’×™××•×ª × ×¤×•×¦×•×ª:
- E01: ×ª×§×œ×ª ×”××¨×§×” - ×‘×“×•×§ ×—×™×‘×•×¨ ×”××¨×§×”
- E05: ×–×¨× ×™×ª×¨ - ×”×¤×¢×œ ×ž×—×“×© MCB
- E47: Ground Fault - × ×ª×§ ×ž×ª×— ×œ×ž×©×š 30 ×©× ×™×•×ª

×ª×—×–×•×§×”:
- × ×™×§×•×™ ×—×™×¦×•× ×™: ××—×ª ×œ×—×•×“×© ×‘×ž×˜×œ×™×ª ×œ×—×”
- ×‘×“×™×§×ª ×›×‘×œ×™×: ××—×ª ×œ-3 ×—×•×“×©×™×
- ×¢×“×›×•×Ÿ ×ª×•×›× ×”: ××•×˜×•×ž×˜×™ ×“×¨×š ×¨×©×ª
    `.trim(),
    metadata: {
      source: 'charger_spec',
      category: 'chargers',
      manufacturer: 'ABB',
      model: 'Terra AC Wallbox',
    },
  },
  {
    content: `
ABB Terra 54 CJG DC Fast Charger:
- ×™×¦×¨×Ÿ: ABB (×©×•×•×™×¥)
- ×¡×•×’: ×ž×˜×¢×Ÿ DC ×ž×”×™×¨
- ×”×¡×¤×§: 50kW
- ×ž×—×‘×¨×™×: CCS2, CHAdeMO
- ×›×‘×œ×™×: 2 ×›×‘×œ×™× ×‘×•-×–×ž× ×™×™× (CCS + CHAdeMO)
- ×ª×§×©×•×¨×ª: 4G, Ethernet
- ×¤×¨×•×˜×•×§×•×œ: OCPP 1.6J
- ×ž×¡×š: ×ž×¡×š ×ž×’×¢ 10 ××™× ×¥'
- ×§×¨×™××ª RFID/NFC: ×›×Ÿ
- ×ž×™×“×•×ª: 730 Ã— 600 Ã— 1,750 ×ž"×ž
- ×ž×©×§×œ: 300 ×§"×’
- ×“×™×¨×•×’: IP54
- ×§×™×¨×•×¨: ×ž××•×•×¨×¨×™×

×©×’×™××•×ª × ×¤×•×¦×•×ª:
- E42: Ground Fault - ×‘×¢×™×” ×‘×”××¨×§×”, ×“×•×¨×© ×˜×›× ××™
- E51: Communication Error - ××¤×¡ ×ž×•×“×
- E47: Emergency Stop Active - ×©×—×¨×¨ ×›×¤×ª×•×¨ ×—×™×¨×•×

×¤×ª×¨×•× ×•×ª:
- Hard Reset: × ×ª×§ MCB ×œ-60 ×©× ×™×•×ª, ×—×‘×¨ ×ž×—×“×©
- Soft Reset: ×ž×¡×š ×ª×¤×¨×™×˜ > Settings > Reboot
- Remote Reset: ×‘××¤×œ×™×§×¦×™×” ××• ×¤×•×¨×˜×œ ×ª×ž×™×›×”
    `.trim(),
    metadata: {
      source: 'charger_spec',
      category: 'chargers',
      manufacturer: 'ABB',
      model: 'Terra 54 CJG',
    },
  },
  {
    content: `
Tritium Veefil-PK DC Fast Charger:
- ×™×¦×¨×Ÿ: Tritium (××•×¡×˜×¨×œ×™×”)
- ×¡×•×’: ×ž×˜×¢×Ÿ DC ×ž×”×™×¨
- ×”×¡×¤×§: 25kW - 50kW
- ×ž×—×‘×¨×™×: CCS, CHAdeMO (××•×¤×¦×™×”)
- ×ª×§×©×•×¨×ª: 4G, Ethernet, WiFi
- ×¤×¨×•×˜×•×§×•×œ: OCPP 1.6J
- ×ž×¡×š: LED status indicators
- ×ž×™×“×•×ª: 800 Ã— 400 Ã— 1,000 ×ž"×ž
- ×ž×©×§×œ: 120 ×§"×’
- ×“×™×¨×•×’: IP65
- ×§×™×¨×•×¨: ×¤×¡×™×‘×™ (×œ×œ× ×ž××•×•×¨×¨×™×)

×©×’×™××•×ª × ×¤×•×¦×•×ª:
- 301: Insulation Failure - ×“×•×¨×© ×˜×›× ××™
- 501: Communication Timeout - ×‘×“×•×§ ×—×™×‘×•×¨ ×¨×©×ª
- Wake Up Failed: ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ Reset ×œ×ž×©×š 10 ×©× ×™×•×ª

×™×™×—×•×“×™×•×ª:
- ×§×™×¨×•×¨ ×¤×¡×™×‘×™ = ×¤×—×•×ª ×ª×—×–×•×§×”
- ×¢×ž×™×“ ×‘×ž×™×•×—×“ ×œ×ž×–×’ ××•×•×™×¨ ×§×©×”
- ×—×¡×›×•× ×™ ×‘×× ×¨×’×™×”
    `.trim(),
    metadata: {
      source: 'charger_spec',
      category: 'chargers',
      manufacturer: 'Tritium',
      model: 'Veefil-PK',
    },
  },
  {
    content: `
Kempower Satellite DC Charger:
- ×™×¦×¨×Ÿ: Kempower (×¤×™× ×œ× ×“)
- ×¡×•×’: ×ž×˜×¢×Ÿ DC modular
- ×”×¡×¤×§: 25kW - 200kW (× ×™×ª×Ÿ ×œ×”×¨×—×‘×”)
- ×ž×—×‘×¨×™×: CCS2, CHAdeMO, MCS (×œ×¢×ª×™×“)
- ××¨×›×™×˜×§×˜×•×¨×”: Distributed (Power Unit + Satellites)
- ×ª×§×©×•×¨×ª: Ethernet, 4G
- ×¤×¨×•×˜×•×§×•×œ: OCPP 2.0.1
- Dynamic Power Sharing: ×›×Ÿ (×—×œ×•×§×” ×“×™× ×ž×™×ª ×‘×™×Ÿ ×¨×›×‘×™×)
- ×ž×™×“×•×ª: ×§×•×ž×¤×§×˜×™ - 200 Ã— 150 Ã— 70 ×ž"×ž
- ×ž×©×§×œ: 3 ×§"×’ (×œ×•×•×™×Ÿ ×‘×œ×‘×“)
- ×“×™×¨×•×’: IP54

×™×™×—×•×“×™×•×ª:
- ×—×œ×•×§×ª ×”×¡×¤×§ ×“×™× ×ž×™×ª - ×›×œ ×¨×›×‘ ×ž×§×‘×œ ××ª ×ž×” ×©×”×•× ×¦×¨×™×š
- ×ž×•×“×•×œ×¨×™ - ×§×œ ×œ×”×•×¡×™×£ ×™×—×™×“×•×ª
- ×›×‘×œ ×§×œ (3 ×§"×’) - ×§×œ ×œ×˜×¢×•×Ÿ

×©×™×ž×•×©:
- ×ª×§×•×¢ ×›×‘×œ? ×œ×—×¥ ×œ×ž×©×š 5 ×©× ×™×•×ª ×¢×“ ×§×œ×™×§
- ×”×›×‘×œ ×¦×¨×™×š ×œ×”×™×•×ª ×ž×•×—×–×§ 5 ×©× ×™×•×ª ×œ×¤× ×™ ×©×—×¨×•×¨
    `.trim(),
    metadata: {
      source: 'charger_spec',
      category: 'chargers',
      manufacturer: 'Kempower',
      model: 'Satellite',
    },
  },
  // Add 31 more manufacturers...
];

async function main() {
  const args = process.argv.slice(2);
  const clearFlag = args.includes('--clear');
  const fileArg = args.find((arg) => arg.startsWith('--file='));

  logger.info('Starting knowledge base ingestion...');

  const vectorStore = getVectorStore();

  // Initialize Pinecone index
  await vectorStore.initialize();

  // Clear namespace if requested
  if (clearFlag) {
    logger.info('Clearing existing vectors...');
    await vectorStore.deleteNamespace();
  }

  // Prepare documents
  let documents: Document[] = [];

  // Add Hebrew knowledge base
  const hebrewDocs = HEBREW_KNOWLEDGE_BASE.map(
    (doc) =>
      new Document({
        pageContent: doc.content,
        metadata: doc.metadata,
      })
  );
  documents.push(...hebrewDocs);

  // Add charger database
  const chargerDocs = CHARGER_DATABASE.map(
    (doc) =>
      new Document({
        pageContent: doc.content,
        metadata: doc.metadata,
      })
  );
  documents.push(...chargerDocs);

  // Add custom file if provided
  if (fileArg) {
    const filePath = fileArg.split('=')[1];
    logger.info('Loading custom file...', { filePath });

    const content = fs.readFileSync(filePath, 'utf-8');
    const customDoc = new Document({
      pageContent: content,
      metadata: {
        source: 'custom',
        category: 'custom',
        file: path.basename(filePath),
      },
    });
    documents.push(customDoc);
  }

  // Ingest documents
  logger.info('Ingesting documents...', { count: documents.length });
  await vectorStore.addDocuments(documents);

  // Get stats
  const stats = await vectorStore.getStats();
  logger.info('Ingestion complete!', { stats });

  // Test search
  logger.info('Testing semantic search...');
  const testQuery = '××™×š ×œ×”×ª×—×™×œ ×˜×¢×™× ×”';
  const results = await vectorStore.searchWithScores(testQuery, 3);

  logger.info('Search results:', {
    query: testQuery,
    results: results.map(([doc, score]) => ({
      score,
      source: doc.metadata.source,
      preview: doc.pageContent.substring(0, 100) + '...',
    })),
  });

  logger.info('Knowledge base ingestion complete! ðŸŽ‰');
}

// Run if called directly
if (require.main === module) {
  main().catch((error) => {
    logger.error('Ingestion failed', { error });
    process.exit(1);
  });
}

export { main as ingestKnowledgeBase };
