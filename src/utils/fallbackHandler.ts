// Fallback responses when services are unavailable
export const FALLBACK_RESPONSES = {
  he: `ืืฆืืขืจ ืืืื, ืื ืืืขืจืืช ืฉืื ืืชืงืื ืืืขืื ืืืืืช. ๐

ืืื ืื ืืืื ืืืฉืช ืืืขืจืืืช ืืจืืข, ืืื ืืื ืืื ืืขืืืจ ืืืจืืื ืืืจืืช:

๐ **ืฆืืจ ืงืฉืจ ืขื ืืชืืืื:**
- ืืืคืื: 1-800-CHARGE
- ืืืืืื: support@edgecontrol.com

๐ก **ืืืคืื ืืืืจืื ืืืืชืืื:**
- ืืื ืฉืืืื ืืืืืจ ืืืื ืืจืื ืืืขืืื
- ืืกื ืืืืฆืื ืืืืืืืก ืืช ืืืื ืฉืื
- ืืืืง ืฉืืืคืืืงืฆืื ืืขืืืืืช ืืืจืกื ืืืืจืืื
- ืื ืืขืืื ืื ืขืืืืช, ืืกื ืขืืื ืกืืืื ืืืจืช

ืืฉืื ืืขืืืจ ืืื ืืฉืืืขืจืืช ืชืืืืจ ืืคืขืืื!`,

  en: `I'm very sorry, but my system is experiencing a temporary issue. ๐

I can't access the systems right now, but I'm here to help in other ways:

๐ **Contact Support:**
- Phone: 1-800-CHARGE
- Email: support@edgecontrol.com

๐ก **Quick tips in the meantime:**
- Make sure the cable is firmly connected to your car and the station
- Try unplugging and reconnecting the cable
- Check that your app is updated to the latest version
- If the station isn't working, try another nearby station

I'll be happy to help as soon as the system is back online!`,

  ru: `ะะฝะต ะพัะตะฝั ะถะฐะปั, ะฝะพ ะผะพั ัะธััะตะผะฐ ััะพะปะบะฝัะปะฐัั ั ะฒัะตะผะตะฝะฝะพะน ะฟัะพะฑะปะตะผะพะน. ๐

ะฏ ะฝะต ะผะพะณั ะฟะพะปััะธัั ะดะพัััะฟ ะบ ัะธััะตะผะฐะผ ัะตะนัะฐั, ะฝะพ ั ะทะดะตัั, ััะพะฑั ะฟะพะผะพัั ะดััะณะธะผะธ ัะฟะพัะพะฑะฐะผะธ:

๐ **ะกะฒัะทะฐัััั ั ะฟะพะดะดะตัะถะบะพะน:**
- ะขะตะปะตัะพะฝ: 1-800-CHARGE
- Email: support@edgecontrol.com

๐ก **ะัััััะต ัะพะฒะตัั:**
- ะฃะฑะตะดะธัะตัั, ััะพ ะบะฐะฑะตะปั ะฝะฐะดะตะถะฝะพ ะฟะพะดะบะปััะตะฝ ะบ ะฐะฒัะพะผะพะฑะธะปั ะธ ััะฐะฝัะธะธ
- ะะพะฟัะพะฑัะนัะต ะพัะบะปััะธัั ะธ ัะฝะพะฒะฐ ะฟะพะดะบะปััะธัั ะบะฐะฑะตะปั
- ะัะพะฒะตัััะต, ััะพ ะฒะฐัะต ะฟัะธะปะพะถะตะฝะธะต ะพะฑะฝะพะฒะปะตะฝะพ ะดะพ ะฟะพัะปะตะดะฝะตะน ะฒะตััะธะธ
- ะัะปะธ ััะฐะฝัะธั ะฝะต ัะฐะฑะพัะฐะตั, ะฟะพะฟัะพะฑัะนัะต ะดััะณัั ะฑะปะธะถะฐะนััั ััะฐะฝัะธั

ะัะดั ัะฐะด ะฟะพะผะพัั, ะบะฐะบ ัะพะปัะบะพ ัะธััะตะผะฐ ะฒะตัะฝะตััั ะฒ ะพะฝะปะฐะนะฝ!`,

  ar: `ุฃูุง ุขุณู ุฌุฏุงูุ ููู ูุธุงูู ููุงุฌู ูุดููุฉ ูุคูุชุฉ. ๐

ูุง ูููููู ุงููุตูู ุฅูู ุงูุฃูุธูุฉ ุงูุขูุ ููููู ููุง ูููุณุงุนุฏุฉ ุจุทุฑู ุฃุฎุฑู:

๐ **ุงูุงุชุตุงู ุจุงูุฏุนู:**
- ุงููุงุชู: 1-800-CHARGE
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: support@edgecontrol.com

๐ก **ูุตุงุฆุญ ุณุฑูุนุฉ ูู ูุฐู ุงูุฃุซูุงุก:**
- ุชุฃูุฏ ูู ุชูุตูู ุงููุงุจู ุจุฅุญูุงู ุจุณูุงุฑุชู ูุงููุญุทุฉ
- ุญุงูู ูุตู ุงููุงุจู ูุฅุนุงุฏุฉ ุชูุตููู
- ุชุญูู ูู ุชุญุฏูุซ ุชุทุจููู ุฅูู ุฃุญุฏุซ ุฅุตุฏุงุฑ
- ุฅุฐุง ูู ุชุนูู ุงููุญุทุฉุ ุฌุฑุจ ูุญุทุฉ ูุฑูุจุฉ ุฃุฎุฑู

ุณุฃููู ุณุนูุฏุงู ุจุงููุณุงุนุฏุฉ ุจูุฌุฑุฏ ุนูุฏุฉ ุงููุธุงู ููุนูู!`
};

/**
 * Get fallback response in appropriate language
 */
export function getFallbackResponse(language: 'he' | 'en' | 'ru' | 'ar' = 'he'): string {
  return FALLBACK_RESPONSES[language] || FALLBACK_RESPONSES.he;
}

/**
 * Track service health
 */
class ServiceHealthTracker {
  private failures: Map<string, { count: number; lastFailure: number }> = new Map();
  private readonly maxFailures = 3;
  private readonly failureWindow = 5 * 60 * 1000; // 5 minutes

  recordFailure(service: string): void {
    const now = Date.now();
    const current = this.failures.get(service) || { count: 0, lastFailure: 0 };

    // Reset count if outside failure window
    if (now - current.lastFailure > this.failureWindow) {
      current.count = 0;
    }

    current.count++;
    current.lastFailure = now;
    this.failures.set(service, current);
  }

  recordSuccess(service: string): void {
    this.failures.delete(service);
  }

  isHealthy(service: string): boolean {
    const current = this.failures.get(service);
    if (!current) return true;

    const now = Date.now();
    
    // Service is unhealthy if too many recent failures
    if (current.count >= this.maxFailures && (now - current.lastFailure) < this.failureWindow) {
      return false;
    }

    return true;
  }

  getStatus(service: string): { healthy: boolean; failures: number; lastFailure: number | null } {
    const current = this.failures.get(service);
    return {
      healthy: this.isHealthy(service),
      failures: current?.count || 0,
      lastFailure: current?.lastFailure || null,
    };
  }
}

export const serviceHealthTracker = new ServiceHealthTracker();
